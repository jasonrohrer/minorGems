#!/bin/sh

# call this script from inside your game's project folder
# By default, this script creates a Makefile inside your project's "gameSource"
# directory and looks for minorGems in ../minorGems.

# These can be overriden by setting environment variables TARGET_MAKEFILE_PATH
# and MG_PATH.

# Example:
# export MG_PATH="../../minorGems"
# export TARGET_MAKEFILE_PATH="."
# ../../minorGems/game/platforms/SDL/configure



#
# Modification History
#
# 2010-April-2    Andy Sommerville
# Allow menu choice from argv.
# "exit 1" when user chooses 'q'; terminate build.
#
# 2006-June-27    Jason Rohrer
# Copied/modified from Transcend project.  Dropped a platforms that were only
# nominally supported.
#
# 2010-December-31   Jason Rohrer
# Switched to sh for MinGW compatability and dropped bashisms, thanks to a
# patch by Ori Avtalion.
#


MG_PATH_DEFINED=`printenv | grep -c '^MG_PATH='`

TARGET_MAKEFILE_PATH_DEFINED=`printenv | grep -c '^TARGET_MAKEFILE_PATH='`


if [ "$MG_PATH_DEFINED" = "1" ]
then
	mgPath="$MG_PATH"
else
	mgPath="../minorGems"
fi


if [ "$TARGET_MAKEFILE_PATH_DEFINED" = "1" ]
then
	targetPath="$TARGET_MAKEFILE_PATH"
else
	targetPath="gameSource"
fi


targetMakefile="$targetPath/Makefile"



if [ "$#" -gt "0" ] ; then
  if [ "$1" -lt "6" ] ; then
    if [ "$1" -gt "0" ] ; then
      platformSelection="$1"
    fi
  fi
fi



if [ "$#" -gt "1" ] ; then
  mgPath="$2";   
fi




while [ -z "$platformSelection" ]
do

    echo "select platform:"

    echo "  1 --  GNU/Linux"
    echo "  2 --  MacOSX"
    echo "  3 --  Win32 using MinGW"
    echo "  4 --  Raspbian on Raspberry Pi (experimental)"
    echo "  5 --  Crosscompile for Windows on Linux"
    echo "  q --  quit"

    echo ""
    echo -n "> "

    read platformSelection

	
	if [ "$platformSelection" = "q" ]
    then
        exit 1
    fi


    # use ASCII comparison.

	if [ "$platformSelection" -gt "5" ]
    then
        platformSelection=""
    fi

    if [ "$platformSelection" -lt "1" ]
    then
        platformSelection=""
    fi

done


# use partial makefiles from minorGems project
makefileMinorGems="$mgPath/build/Makefile.minorGems"
makefileMinorGemsTargets="$mgPath/build/Makefile.minorGems_targets"



platformName="Generic"
platformMakefile="generic"


makefilePath="$mgPath/game/platforms/SDL"
commonMakefile="$makefilePath/Makefile.common"

makefileAll="$makefilePath/Makefile.all"



case "$platformSelection" in


    "1" )
        platformName="GNU/Linux"
        platformMakefile="$makefilePath/Makefile.GnuLinux"
    ;;

    "2" )
        platformName="MacOSX"
        platformMakefile="$makefilePath/Makefile.MacOSX"
    ;;

    "3" )
        platformName="Win32 MinGW"
        platformMakefile="$makefilePath/Makefile.MinGW"
    ;;

    "4" )
        platformName="Raspbian"
        platformMakefile="$makefilePath/Makefile.Raspbian"
    ;;

    "5" )
        platformName="Win32 MinGW on Linux"
        platformMakefile="$makefilePath/Makefile.MinGWCross"
    ;;


esac



rm -f Makefile.temp
echo "# Auto-generated by game9/configure for the $platformName platform.  Do not edit manually." > Makefile.temp

rm -f $targetMakefile
cat Makefile.temp $platformMakefile $commonMakefile $makefileMinorGems $makefileAll $makefileMinorGemsTargets > $targetMakefile


rm Makefile.temp



exit
